### JS是怎么工作的

#### 解析
1. 将源代码作为静态文本转换为抽象语法树（AST）的数据结构
2. AST：结构化
3. 在之后的语义分析中，编译器验证程序和语言元素的语法使用是否正确
4. 使用AST生成实际的字节码或机器码

#### 抽象语法树
1. 静态代码分析：抽样语法树同样可以用于静态代码分析阶段
2. JavaScript 解析器使用 启发法(heuristics) 来决定是否立即运行指定的代码片段或者推迟在未来的某个时候运行。基于这些启发法，解析器将进行即时或懒解析
3. 启发法是针对模型求解方法而言的，是一种逐次逼近最优解的方法。这种方法对所求得的解进行反复判断实践修正直至满意为止。
4. 立即解析会运行需要立即编译的函数。它主要做三件事:构建 AST，构建作用域层级和查找所有语法错误。
5. 懒解析只运行未编译的函数。它不构建AST，也不查找所有语法错误，它只构建作用域层级，与立即解析相比节省了大约一半的时间。
6. 那么为什么解析器不都使用懒解析呢? 如果懒解析某些代码，这些代码需要立即执行，这实际上会使代码运行速度变慢。需要运行一次懒解析之后进行另一个立即解析，这和立即解析相比，运行速度会慢 50%。
7. 如果解析器看到一个左括号，紧接着是一个函数声明，它将立即解析这个函数。
```
// 立即执行代码
var myModule = (function() {
  // 整个模块的逻辑
  // 返回模块对象
})();


// 执行懒解析
// 第二个foo不是必须的，但建议给函数命名，因为在抛出异常的情况下，会保留实际函数名称，而不仅仅是 <anonymous>
var foo = function foo(x) {
  return x * 10;
};

```
8. Optimize.js: 优化 JavaScript 源代码的初始加载时间，它们对代码进行静态分析，然后通过使用括号封装需要立即运行的函数以便浏览器立即解析并准备运行它们。
```
!function(){console.log('Hello, World!')}();

// 以上代码会在懒解析后立即执行立即解析，会是代码运行的更慢
```

#### 提升编译速度的技巧
1. 检查依赖，减少不必要的依赖
2. 分割代码为更小的块而不是一整陀的
3. 尽可能推迟加载 JavaScript，按需要加载或者动态加载。
4. 使用开发者工具和 DeviceTiming 来检测性能瓶颈
5. 用像 Optimize.js 的工具来帮助解析器选择立即解析或者懒解析以加快解析速度

[原文链接](https://github.com/qq449245884/xiaozhi/issues/14)

2019.12.25